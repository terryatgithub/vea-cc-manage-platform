(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ecc0b95a"],{"251b":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form-item",{attrs:{label:e.label,prop:e.prop,rules:e.rules}},[e.isReadonly?[e._v(" "+e._s(e.value))]:n("el-input",{attrs:{value:e.value},on:{input:function(t){return e.$emit("input",t)},change:function(t){return e.$emit("change",t)}}})],2)},i=[],a=n("ee5c"),r={mixins:[a["a"]],data:function(){return{}}},c=r,s=n("2877"),l=Object(s["a"])(c,o,i,!1,null,null,null);t["a"]=l.exports},"27f2":function(e,t,n){},"39a9":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form-item",{attrs:{label:e.label,prop:e.prop,rules:e.rules}},[e.isReadonly?[e._v(" "+e._s(e.getLabel(e.value)))]:["radio"===e.type?n("el-radio-group",{attrs:{value:e.value,disabled:e.disabled},on:{input:e.handleInputVal,change:function(t){return e.$emit("change",t)}}},e._l(e.options,function(t,o){return n("el-radio",{key:o,attrs:{disabled:t.disabled,label:t.value}},[e._v("\n          "+e._s(t.label)+"\n        ")])}),1):n("el-select",{attrs:{value:e.value,disabled:e.disabled,placeholder:e.placeholder||"请选择",filterable:e.filterable,"allow-create":e.allowCreate},on:{input:e.handleInputVal,change:function(t){return e.$emit("change",t)}}},e._l(e.options,function(e,t){return n("el-option",{key:t,attrs:{disabled:e.disabled,label:e.label,value:e.value}})}),1)],e._t("default")],2)},i=[],a=(n("7514"),n("ee5c")),r={mixins:[a["a"]],data:function(){return{}},props:["type","options","filterable","allowCreate","confirm"],methods:{getLabel:function(e){var t=this.options||[],n=t.find(function(t){var n=t.value;return n===e});if(n)return n.label},handleInputVal:function(e){var t,n,o=this,i=this.confirm;i?("string"===typeof i?(t="提示",n=i):(t=i.title,n=i.content),this.$confirm(n,t).then(function(){o.$emit("input",e)}).catch(function(){})):this.$emit("input",e)}}},c=r,s=n("2877"),l=Object(s["a"])(c,o,i,!1,null,null,null);t["a"]=l.exports},"46ebf":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form-item",{attrs:{label:e.label,prop:e.prop,rules:e.rules}},[e.isReadonly?[e._t("read",[e._v(" "+e._s(e.value)+" ")])]:[e._t("edit",[e._v(" "+e._s(e.value))])]],2)},i=[],a=n("ee5c"),r={mixins:[a["a"]],data:function(){return{}}},c=r,s=n("2877"),l=Object(s["a"])(c,o,i,!1,null,null,null);t["a"]=l.exports},"573e":function(e,t,n){"use strict";n.r(t);var o,i,a=n("9840"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("PageWrapper",[n("PageContentWrapper",[n("ContentCard",{attrs:{title:e.title},on:{"go-back":function(t){return e.$emit("go-back")}}},[n("CommonContent",{attrs:{mode:e.mode,"resource-info":e.resourceInfo},on:{replicate:function(t){e.mode="replicate"},edit:function(t){e.mode="edit"},unaudit:function(t){return e.$emit("upsert-end")},shelves:e.fetchData,audit:function(t){return e.$emit("upsert-end")},copy:function(t){return e.handleCopy(t)},"submit-audit":e.handleSubmitAudit,"save-draft":e.handleSaveDraft,"select-version":e.fetchData,delete:function(t){return e.$emit("upsert-end",t)}}},[n("DataForm",{ref:"dataForm",attrs:{readonly:"read"===e.mode,model:e.topic,rules:e.rules,"label-width":"120px"}},[n("div",{staticClass:"form-legend-header"},[n("i",{staticClass:"el-icon-edit"},[e._v("话题类型")])]),n("Enum",{attrs:{label:"话题类型",options:e.$consts.topicTypesOptions},on:{change:e.handleTopicTypeChange},model:{value:e.topic.type,callback:function(t){e.$set(e.topic,"type",t)},expression:"topic.type"}}),n("div",{staticClass:"form-legend-header"},[n("i",{staticClass:"el-icon-edit"},[e._v("话题配置")])]),n("String",{attrs:{label:"话题名",prop:"topicName"},model:{value:e.topic.topicName,callback:function(t){e.$set(e.topic,"topicName",t)},expression:"topic.topicName"}}),1===e.topic.type?n("String",{attrs:{prop:"recommendSign",label:"推荐流标记"},model:{value:e.topic.recommendSign,callback:function(t){e.$set(e.topic,"recommendSign",t)},expression:"topic.recommendSign"}}):e._e(),n("Enum",{attrs:{label:"话题icon",type:"radio",options:e.iconOptions,value:e.topic.iconType},on:{input:e.handleInputIconType}}),"custom"===e.topic.iconType?n("el-form-item",{attrs:{label:"",prop:"icon"}},[n("GlobalPictureSelector",{attrs:{disabled:"read"===e.mode,pictureResolution:"30*30"},on:{"select-end":e.handleSelectIcon}},[e.topic.icon?n("img",{staticClass:"icon-img",attrs:{src:e.topic.icon}}):n("div",{staticClass:"icon-img"})])],1):e._e(),2===e.topic.type?n("Enum",{attrs:{label:"内容源",confirm:{title:"提示",content:"切换源将清空短视频，确定切换?"},type:"radio",disabled:"replicate"===e.mode,options:e.$consts.sourceOptions,value:e.topic.source},on:{input:function(t){e.topic.source=t,e.topic.contentList=[]}}}):e._e(),2===e.topic.type?[n("div",{staticClass:"form-legend-header"},[n("i",{staticClass:"el-icon-edit"},[e._v("短视频筛选")])]),n("Any",{attrs:{label:"短视频",readonly:"read"===e.mode}},[n("div",{attrs:{slot:"edit"},slot:"edit"},[n("ResourceSelector",{attrs:{source:e.topic.source,selectors:["shortVideo"],"disable-partner":!0,"auto-fetch-selectors":["shortVideo"],"selection-type":"multiple"},on:{"select-end":e.handleSelectVideoEnd}},[n("el-button",{attrs:{type:"primary",plain:""}},[e._v("\n                    选择短视频\n                  ")])],1),n("OrderableTable",{attrs:{header:e.shortVideoListHeader},model:{value:e.topic.contentList,callback:function(t){e.$set(e.topic,"contentList",t)},expression:"topic.contentList"}})],1),n("div",{attrs:{slot:"read"},slot:"read"},[n("OrderableTable",{attrs:{readonly:!0,"hide-action":!0,header:e.shortVideoListHeader},model:{value:e.topic.contentList,callback:function(t){e.$set(e.topic,"contentList",t)},expression:"topic.contentList"}})],1)])]:e._e()],2)],1)],1)],1)],1)},c=[],s=(n("ac6a"),n("4bc7")),l=n("5f87"),u=n("5eb0"),p=n("c3d5"),d=n("b1cd"),h=n("cc30"),f=n("363f"),m=n("03df"),b=n("2ef0"),v=n("6ab8"),g=n("251b"),y=n("39a9"),S=n("46ebf"),C={components:{PageWrapper:s["a"],PageContentWrapper:l["a"],ContentCard:u["a"],CommonContent:p["a"],GlobalPictureSelector:d["a"],ResourceSelector:h["a"],OrderableTable:m["a"],DataForm:v["a"],String:g["a"],Enum:y["a"],Any:S["a"]},mixins:[f["a"]],data:function(){var e=this;return{mode:"create",resourceName:"短视频话题",versionList:[],iconOptions:[{label:"默认icon",value:"default"},{label:"自定义icon",value:"custom"}],shortVideoListHeader:[{label:"短视频ID",prop:"sCoocaaMId"},{label:"短视频标题",prop:"sShowTitle"},{label:"内容源",prop:"source",render:function(t,n){var o=n.row;return e.$consts.partnerText[o.source]}},{label:"短视频时长",prop:"mDuration",render:function(t,n){var o=n.row;return e.secondToTimeStr(o.mDuration)}},{label:"平均播放时长",prop:"avgPerplayTimeSec",render:function(t,n){var o=n.row;return e.secondToTimeStr(o.avgPerplayTimeSec)}}],topic:{id:void 0,type:this.$consts.topicTypesOptions[1].value,topicName:"",source:"o_tencent",iconType:"default",icon:"",status:void 0,contentList:[],recommendSign:void 0,currentVersion:"",duplicateVersion:void 0},rules:{topicName:[{required:!0,message:"请输入话题标题"},{max:30,message:"不能超过 30 个字符"}],recommendSign:[{required:!0,message:"请输入标记"}],icon:[{required:!0,message:"请选择自定义 icon"}]}}},props:["initMode","id","version"],computed:{resourceInfo:function(){var e=this.topic;if(e.id)return{id:e.id,type:"topic",menuElId:"topic",version:e.currentVersion,status:e.status}}},methods:{secondToTimeStr:function(e){if(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),o=e-3600*t-60*n;return"".concat(t,"小时").concat(n,"分").concat(o,"秒")}},handleInputIconType:function(e){this.topic.iconType=e,"default"===e&&(this.topic.icon="")},fetchData:function(e){var t=this;this.$service.topicGetDetail({id:this.id,version:e}).then(function(e){t.setData(e)})},setData:function(e){var t=Object(b["cloneDeep"])(e),n=t.contentList||[];t.contentList=n.map(function(e){var t=e.positiveInfo?JSON.parse(e.positiveInfo):{};return{sShowThumb:e.thumb,sShowTitle:e.title,sCoocaaMId:e.shortVideoId,mDuration:t.mDuration,source:t.source}}),t.icon?t.iconType="custom":t.iconType="default",this.topic=t},handleSelectIcon:function(e){this.topic.icon=e.pictureUrl},handleTopicTypeChange:function(){var e=this.$consts,t=this.topic;t.source=2===t.type?e.sourceOptions[0].value:"",t.recommendSign="",t.contentList=[]},handleTopicSourceChange:function(){this.topic.contentList=[]},handleSelectVideoEnd:function(e){var t=e.shortVideo,n="sCoocaaMId",o=t||[],i=this.topic.contentList||[],a=i.reduce(function(e,t,o){return e[t[n]]=o,e},{}),r=this.$consts.sourcePrefix[this.topic.source]||"";o.forEach(function(e){e.sCoocaaMId=r+e.sCoocaaMId});var c=o.filter(function(e){return void 0===a[e[n]]});this.topic.contentList=i.concat(c)},validate:function(e,t){var n=this;this.$refs.dataForm.$refs.form.validate(function(e){e?t():n.$message({type:"error",message:"请把表单填写完整"})})},handleSubmitAudit:function(){var e=this,t=Object(b["cloneDeep"])(this.topic);t.iconType=void 0,t.status=this.$consts.status.waiting,this.validate(t,function(){e.submit(t)})},handleSaveDraft:function(){var e=this,t=Object(b["cloneDeep"])(this.topic);t.iconType=void 0,t.status=this.$consts.status.draft,this.validate(t,function(){e.submit(t)})},submit:function(e){var t=this;return this.$service.topicUpsert(this.parseDataToApi(e),"保存成功").then(function(){t.$emit("upsert-end")})},parseDataToApi:function(e){var t=this.mode;return e.contentList=e.contentList.map(function(e){return{shortVideoId:e.sCoocaaMId,title:e.sShowTitle,thumb:e.sShowThumb,positiveInfo:JSON.stringify({mDuration:e.mDuration,source:e.source})}}),"replicate"===t&&(e.currentVersion=""),e}},created:function(){this.mode=this.initMode||"create",this.id&&this.fetchData(this.version)}},T=C,$=(n("ebde"),n("2877")),w=Object($["a"])(T,r,c,!1,null,"38b9e084",null),_=w.exports,x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("PageWrapper",[n("PageContentWrapper",[n("ContentCard",{ref:"contentCard",staticClass:"content"},[n("ContentWrapper",{attrs:{filter:e.filter,filterSchema:e.filterSchema,pagination:e.pagination},on:{"filter-change":e.handleFilterChange,"filter-reset":e.handleFilterReset}},[n("ButtonGroupForListPage",{attrs:{pageName:"topic"},on:{add:e.handleCreate,edit:e.handleEdit,delete:e.handleDelete}}),n("Table",{attrs:{props:e.table.props,header:e.table.header,data:e.table.data,selected:e.table.selected,"selection-type":e.table.selectionType,"select-on-row-click":!0},on:{"row-selection-add":e.handleRowSelectionAdd,"row-selection-remove":e.handleRowSelectionRemove,"all-row-selection-change":e.handleAllRowSelectionChange}})],1)],1)],1)],1)},D=[],I=n("f6e7"),L=n.n(I),O=n("5c96"),P=n("59c7"),V=n("2df9"),E=n("3912"),R={extends:E["a"],components:{Table:P["Table"],ContentWrapper:P["ContentWrapper"],PageWrapper:s["a"],PageContentWrapper:l["a"],ButtonGroupForListPage:V["a"]},data:function(){var e=this;this.$createElement;return{resourceType:"topic",activePage:"topic_list",filter:{},filterSchema:null,pagination:{},selected:[],table:{props:{},header:[{label:"ID",prop:"id"},{label:"话题名",prop:"topicName",minWidth:150,render:function(t,n){var o=n.row;return t(O["Button"],{props:{type:"text"},on:{click:function(t){t.stopPropagation(),e.handleRead(o)}}},o.topicName)}},{label:"话题类型",prop:"type",render:function(t,n){var o=n.row;return e.$consts.topicTypesText[o.type]}},{label:"短视频源",prop:"source",width:140,render:function(t,n){var o=n.row;return e.$consts.sourceText[o.source]}},{label:"话题状态",prop:"status",render:function(t,n){var o=n.row;return"".concat(o.currentVersion,"/").concat(e.$consts.statusText[o.status])}},{label:"待审核副本",prop:"duplicateVersion",render:function(t,n){var o=n.row,i=o.duplicateVersion;if(i)return t("el-button",{attrs:{type:"text"},on:{click:function(t){t.stopPropagation(),e.handleRead(o,i)}}},[i])}},{label:"操作",width:"140",fixed:"right",render:function(t,n){var o=n.row;if(o.showContentAuthSettingBtn)return t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(t){t.stopPropagation(),e.handleOpenContentAuthManager(o)}}},["内容权限"])])}}],data:[],selected:[],selectionType:"multiple"}}},computed:{},methods:{handleOpenContentAuthManager:function(e){this.$refs.contentCard.handleShowContentAuthManager({id:e.homepageId,type:"topic",menuElId:"topic"})},handleFilterChange:function(e,t){t&&(this.filter=t),"query"===e&&this.pagination&&(this.pagination.currentPage=1),this.fetchData()},handleFilterReset:function(){this.filter={sort:void 0,order:void 0},this.pagination.currentPage=1,this.fetchData()},parseFilter:function(){var e=this.filter,t=this.pagination;return t&&(e.page=t.currentPage,e.rows=t.pageSize),e},fetchData:function(){var e=this,t=this.parseFilter();this.$service.topicGetList(t).then(function(t){e.pagination.total=t.total,e.table.data=t.rows})}},created:function(){this.filterSchema=L.a.map({topicName:L.a.o.string.other("form",{component:"Input",placeholder:"话题名",label:" "}),type:L.a.o.enum(this.$consts.topicTypesEnum).other("form",{component:"Select",placeholder:"话题类型",label:" ",clearable:!0}),source:L.a.o.enum(this.$consts.sourceEnums).other("form",{component:"Select",placeholder:"内容源",label:" ",clearable:!0})}).other("form",{cols:{item:3,label:0,wrapper:23},layout:"inline",footer:{cols:{label:0,wrapper:24},showSubmit:!0,submitText:"查询",showReset:!0,resetText:"重置"}}),this.fetchData()}},k=R,F=Object($["a"])(k,x,D,!1,null,"22282168",null),M=F.exports,N={extends:a["a"],components:{ResourceList:M,ResourceContent:_},data:function(){return{}},computed:{resourceInfo:function(){return{type:"topic",idField:"id"}}}},j=N,A=Object($["a"])(j,o,i,!1,null,null,null);t["default"]=A.exports},"6ab8":function(e,t,n){"use strict";var o,i,a=n("cebc"),r={provide:function(){return{dataForm:this}},props:["readonly"],render:function(e){return e("el-form",{ref:"form",props:Object(a["a"])({},this.$attrs)},this.$slots.default)}},c=r,s=n("2877"),l=Object(s["a"])(c,o,i,!1,null,null,null);t["a"]=l.exports},ebde:function(e,t,n){"use strict";var o=n("27f2"),i=n.n(o);i.a},ee5c:function(e,t,n){"use strict";t["a"]={inject:["dataForm"],props:{value:{},label:String,disabled:Boolean,readonly:{},prop:String,placeholder:String,errors:{},rules:{}},computed:{isReadonly:function(){var e=this.readonly;return void 0!==e?e:this.dataForm.readonly}}}}}]);
//# sourceMappingURL=chunk-ecc0b95a.846ea201.js.map