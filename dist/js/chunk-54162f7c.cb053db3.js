(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54162f7c"],{"251b":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form-item",{attrs:{label:t.label,prop:t.prop,rules:t.rules}},[t.isReadonly?[t._v(" "+t._s(t.value))]:n("el-input",{attrs:{value:t.value},on:{input:function(e){return t.$emit("input",e)},change:function(e){return t.$emit("change",e)}}})],2)},o=[],a=n("ee5c"),r={mixins:[a["a"]],data:function(){return{}}},s=r,c=n("2877"),l=Object(c["a"])(s,i,o,!1,null,null,null);e["a"]=l.exports},"39a9":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form-item",{attrs:{label:t.label,prop:t.prop,rules:t.rules}},[t.isReadonly?[t._v(" "+t._s(t.getLabel(t.value)))]:["radio"===t.type?n("el-radio-group",{attrs:{value:t.value,disabled:t.disabled},on:{input:t.handleInputVal,change:function(e){return t.$emit("change",e)}}},t._l(t.options,function(e,i){return n("el-radio",{key:i,attrs:{disabled:e.disabled,label:e.value}},[t._v("\n          "+t._s(e.label)+"\n        ")])}),1):n("el-select",{attrs:{value:t.value,disabled:t.disabled,placeholder:t.placeholder||"请选择",filterable:t.filterable,"allow-create":t.allowCreate},on:{input:t.handleInputVal,change:function(e){return t.$emit("change",e)}}},t._l(t.options,function(t,e){return n("el-option",{key:e,attrs:{disabled:t.disabled,label:t.label,value:t.value}})}),1)],t._t("default")],2)},o=[],a=(n("7514"),n("ee5c")),r={mixins:[a["a"]],data:function(){return{}},props:["type","options","filterable","allowCreate","confirm"],methods:{getLabel:function(t){var e=this.options||[],n=e.find(function(e){var n=e.value;return n===t});if(n)return n.label},handleInputVal:function(t){var e,n,i=this,o=this.confirm;o?("string"===typeof o?(e="提示",n=o):(e=o.title,n=o.content),this.$confirm(n,e).then(function(){i.$emit("input",t)}).catch(function(){})):this.$emit("input",t)}}},s=r,c=n("2877"),l=Object(c["a"])(s,i,o,!1,null,null,null);e["a"]=l.exports},"46ebf":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form-item",{attrs:{label:t.label,prop:t.prop,rules:t.rules}},[t.isReadonly?[t._t("read",[t._v(" "+t._s(t.value)+" ")])]:[t._t("edit",[t._v(" "+t._s(t.value))])]],2)},o=[],a=n("ee5c"),r={mixins:[a["a"]],data:function(){return{}}},s=r,c=n("2877"),l=Object(c["a"])(s,i,o,!1,null,null,null);e["a"]=l.exports},5264:function(t,e,n){"use strict";n.r(e);var i,o,a=n("9840"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("PageWrapper",[n("PageContentWrapper",[n("ContentCard",{attrs:{title:t.title},on:{"go-back":function(e){return t.$emit("go-back")}}},[n("CommonContent",{attrs:{mode:t.mode,"resource-info":t.resourceInfo},on:{replicate:function(e){t.mode="replicate"},edit:function(e){t.mode="edit"},unaudit:function(e){return t.$emit("upsert-end")},shelves:t.fetchData,audit:function(e){return t.$emit("upsert-end")},copy:function(e){return t.handleCopy(e)},"submit-audit":t.handleSubmitAudit,"save-draft":t.handleSaveDraft,"select-version":t.fetchData,delete:function(e){return t.$emit("upsert-end",e)}}},[n("DataForm",{ref:"dataForm",attrs:{readonly:"read"===t.mode,model:t.topic,rules:t.rules,"label-width":"100px"}},[n("div",{staticClass:"form-legend-header"},[n("i",{staticClass:"el-icon-edit"},[t._v("基本信息")])]),n("String",{attrs:{label:"名称",readonly:!0},model:{value:t.topic.topicConfigName,callback:function(e){t.$set(t.topic,"topicConfigName",e)},expression:"topic.topicConfigName"}}),n("Enum",{attrs:{label:"内容源",options:t.$consts.sourceOptions,readonly:!0},model:{value:t.topic.source,callback:function(e){t.$set(t.topic,"source",e)},expression:"topic.source"}}),n("Any",{attrs:{label:"话题列表",readonly:"read"===t.mode}},[n("div",{attrs:{slot:"edit"},slot:"edit"},[n("ResourceSelector",{attrs:{"disable-partner":!0,source:t.topic.source,selectors:["shortVideoTopic"],"selection-type":"multiple"},on:{"select-end":t.handleSelectVideoTopicEnd}},[n("el-button",{attrs:{type:"primary",plain:""}},[t._v("\n                  选择话题\n                ")])],1),n("OrderableTable",{attrs:{header:t.shortVideoListHeader},model:{value:t.topic.contentList,callback:function(e){t.$set(t.topic,"contentList",e)},expression:"topic.contentList"}})],1),n("div",{attrs:{slot:"read"},slot:"read"},[n("OrderableTable",{attrs:{readonly:!0,"hide-action":!0,header:t.shortVideoListHeader},model:{value:t.topic.contentList,callback:function(e){t.$set(t.topic,"contentList",e)},expression:"topic.contentList"}})],1)])],1)],1)],1)],1)],1)},s=[],c=(n("7514"),n("ac6a"),n("4bc7")),l=n("5f87"),u=n("5eb0"),d=n("c3d5"),p=n("cc30"),f=n("363f"),h=n("03df"),m=n("2ef0"),v=n("6ab8"),b=n("251b"),g=n("39a9"),C=n("46ebf"),y={components:{PageWrapper:c["a"],PageContentWrapper:l["a"],ContentCard:u["a"],CommonContent:d["a"],ResourceSelector:p["a"],OrderableTable:h["a"],DataForm:v["a"],String:b["a"],Enum:g["a"],Any:C["a"]},mixins:[f["a"]],data:function(){var t=this;return{mode:"create",resourceName:"话题推荐",versionList:[],shortVideoListHeader:[{label:"话题ID",prop:"id",width:80},{label:"话题名",prop:"topicName"},{label:"默认落焦",prop:"topicIsFocus",render:function(e,n){var i=n.row,o=n.$index;return"read"===t.mode?i.topicIsFocus?"是":"":e("el-radio",{props:{label:1,value:i.topicIsFocus},on:{input:function(){t.handleSetDefaultFocus(o)}}},"")}}],topic:{id:void 0,defaultFocusId:void 0,topicConfigName:"",source:void 0,status:void 0,currentVersion:"",duplicateVersion:void 0,contentList:[]},rules:{}}},props:["initMode","id","version"],computed:{resourceInfo:function(){var t=this.topic;if(t.id)return{id:t.id,type:"topicConfig",menuElId:"topicConfig",version:t.currentVersion,status:t.status}}},methods:{fetchData:function(t){var e=this;this.$service.topicConfigGetDetail({id:this.id,version:t}).then(function(t){e.setData(t)})},handleSetDefaultFocus:function(t){var e=this.topic.contentList;e.forEach(function(e,n){e.topicIsFocus=t===n?1:0}),this.topic.contentList=e.slice()},setData:function(t){t=Object(m["cloneDeep"])(t),t.contentList=t.contentList.map(function(t){return{id:t.topicId,topicName:t.topicName,topicIsFocus:t.topicIsFocus}}),this.topic=t},handleSelectIcon:function(t){this.topic.icon=t.pictureUrl},handleTopicTypeChange:function(){this.topic.contentList=[]},handleTopicSourceChange:function(){this.topic.contentList=[]},handleSelectVideoTopicEnd:function(t){var e=t.shortVideoTopic,n="id",i=e||[],o=this.topic.contentList||[],a=o.reduce(function(t,e,i){return t[e[n]]=i,t},{}),r=i.filter(function(t){return void 0===a[t[n]]});this.topic.contentList=o.concat(r)},validate:function(t,e){var n=this,i=function(t){n.$message({type:"error",message:t})};this.$refs.dataForm.$refs.form.validate(function(o){if(o){if(t.status===n.$consts.status.waiting){if(0===t.contentList.length)return i("请选择话题");var a=t.contentList.find(function(t){var e=t.topicIsFocus;return 1===e});if(!a)return i("请设置默认落焦")}e()}else n.$message({type:"error",message:"请把表单填写完整"})})},handleSubmitAudit:function(){var t=this,e=Object(m["cloneDeep"])(this.topic);e.iconType=void 0,e.status=this.$consts.status.waiting,this.validate(e,function(){t.submit(e)})},handleSaveDraft:function(){var t=this,e=Object(m["cloneDeep"])(this.topic);e.iconType=void 0,e.status=this.$consts.status.draft,this.validate(e,function(){t.submit(e)})},submit:function(t){var e=this;return this.$service.topicConfigUpsert(this.parseDataToApi(t),"保存成功").then(function(){e.$emit("upsert-end")})},parseDataToApi:function(t){var e=this.mode;return t.contentList=t.contentList.map(function(t){return{topicId:t.id,topicName:t.topicName,topicIsFocus:t.topicIsFocus?1:0}}),"replicate"===e&&(t.currentVersion=""),t}},created:function(){this.mode=this.initMode||"create",this.id&&this.fetchData(this.version)}},$=y,w=(n("5c98"),n("2877")),L=Object(w["a"])($,r,s,!1,null,"4d10577a",null),_=L.exports,F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("PageWrapper",[n("PageContentWrapper",[n("ContentCard",{ref:"contentCard",staticClass:"content"},[n("ContentWrapper",{attrs:{filter:t.filter,filterSchema:t.filterSchema,pagination:t.pagination},on:{"filter-change":t.handleFilterChange,"filter-reset":t.handleFilterReset}},[n("ButtonGroupForListPage",{attrs:{pageName:"topicConfig"},on:{add:t.handleCreate,edit:t.handleEdit,delete:t.handleDelete}}),n("Table",{attrs:{props:t.table.props,header:t.table.header,data:t.table.data,selected:t.table.selected,"selection-type":t.table.selectionType,"select-on-row-click":!0},on:{"row-selection-add":t.handleRowSelectionAdd,"row-selection-remove":t.handleRowSelectionRemove,"all-row-selection-change":t.handleAllRowSelectionChange}})],1)],1)],1)],1)},D=[],S=n("59c7"),x=n("2df9"),I=n("3912"),T={extends:I["a"],components:{Table:S["Table"],ContentWrapper:S["ContentWrapper"],PageWrapper:c["a"],PageContentWrapper:l["a"],ButtonGroupForListPage:x["a"]},data:function(){var t=this;this.$createElement;return{resourceType:"topicConfig",activePage:"topic_config_list",filter:{},filterSchema:null,pagination:{},selected:[],table:{props:{},header:[{label:"ID",prop:"id"},{label:"名称",prop:"topicConfigName",render:function(e,n){var i=n.row;return e("el-button",{attrs:{type:"text"},on:{click:function(e){e.stopPropagation(),t.handleRead(i)}}},[i.topicConfigName])}},{label:"内容源",prop:"source",render:function(e,n){var i=n.row;return t.$consts.sourceText[i.source]}},{label:"状态",prop:"status",render:function(e,n){var i=n.row;return"".concat(i.currentVersion,"/").concat(t.$consts.statusText[i.status])}},{label:"待审核副本",prop:"duplicateVersion",render:function(e,n){var i=n.row,o=i.duplicateVersion;if(o)return e("el-button",{attrs:{type:"text"},on:{click:function(e){e.stopPropagation(),t.handleRead(i,o)}}},[o])}},{label:"操作",width:"140",fixed:"right"}],data:[],selected:[],selectionType:"multiple"}}},computed:{},methods:{handleOpenContentAuthManager:function(t){this.$refs.contentCard.handleShowContentAuthManager({id:t.homepageId,type:"topic",menuElId:"topic"})},handleFilterChange:function(t,e){e&&(this.filter=e),"query"===t&&this.pagination&&(this.pagination.currentPage=1),this.fetchData()},handleFilterReset:function(){this.filter={sort:void 0,order:void 0},this.pagination.currentPage=1,this.fetchData()},parseFilter:function(){var t=this.filter,e=this.pagination;return e&&(t.page=e.currentPage,t.rows=e.pageSize),t},fetchData:function(){var t=this,e=this.parseFilter();this.$service.topicConfigGetList(e).then(function(e){t.pagination.total=e.total,t.table.data=e.rows})}},created:function(){this.fetchData()}},V=T,O=Object(w["a"])(V,F,D,!1,null,"3ad48230",null),P=O.exports,R={extends:a["a"],components:{ResourceList:P,ResourceContent:_},data:function(){return{}},computed:{resourceInfo:function(){return{type:"topicConfig",idField:"id"}}}},k=R,E=Object(w["a"])(k,i,o,!1,null,null,null);e["default"]=E.exports},"5c98":function(t,e,n){"use strict";var i=n("f2c9"),o=n.n(i);o.a},"6ab8":function(t,e,n){"use strict";var i,o,a=n("cebc"),r={provide:function(){return{dataForm:this}},props:["readonly"],render:function(t){return t("el-form",{ref:"form",props:Object(a["a"])({},this.$attrs)},this.$slots.default)}},s=r,c=n("2877"),l=Object(c["a"])(s,i,o,!1,null,null,null);e["a"]=l.exports},ee5c:function(t,e,n){"use strict";e["a"]={inject:["dataForm"],props:{value:{},label:String,disabled:Boolean,readonly:{},prop:String,placeholder:String,errors:{},rules:{}},computed:{isReadonly:function(){var t=this.readonly;return void 0!==t?t:this.dataForm.readonly}}}},f2c9:function(t,e,n){}}]);
//# sourceMappingURL=chunk-54162f7c.cb053db3.js.map