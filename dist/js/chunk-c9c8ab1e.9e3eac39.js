(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c9c8ab1e"],{3983:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("PageWrapper",{staticClass:"policy-info-wrapper"},[a("PageContentWrapper",{directives:[{name:"show",rawName:"v-show",value:"policy_info"===e.activePage,expression:"activePage === 'policy_info'"}]},[a("ContentCard",{attrs:{title:e.title},on:{"go-back":function(t){return e.$emit("go-back")}}},[a("CommonContent",{attrs:{mode:e.mode,"resource-info":e.resourceInfo},on:{replicate:function(t){e.mode="replicate"},edit:function(t){e.mode="edit"},unaudit:function(t){return e.$emit("upsert-end")},shelves:e.fetchData,"submit-audit":function(t){return e.submitBtn(3)},"save-draft":function(t){return e.submitBtn(2)},audit:function(t){return e.$emit("upsert-end")},"select-version":e.fetchData,delete:function(t){return e.$emit("upsert-end",t)}}},[a("div",{staticClass:"form-legend-header"},[a("i",{staticClass:"el-icon-edit"},[e._v("基本信息")])]),a("DataForm",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"策略名称"}},[e._v("\n            "+e._s(e.form.policyName)+"\n          ")]),a("el-form-item",{attrs:{label:"首页方案"}},[a("Table",{attrs:{"selection-type":"none",header:e.homepageTableHeader,data:e.form.childHpList}})],1)],1)],1)],1)],1),"showHomePageDetail"===e.activePage?a("PageContentWrapper",[a("HomePageInfo",{attrs:{id:e.homePageId,"init-mode":"read",version:e.homePageVersion,"title-prefix":e.title},on:{"upsert-end":function(t){e.activePage="policy_info"},"go-back":function(t){e.activePage="policy_info"}}})],1):e._e()],1)},r=[],o=(a("7514"),a("768b")),n=a("cebc"),l=a("4bc7"),c=a("5f87"),s=a("c3d5"),p=a("ce71"),m=a("07d0"),u=a("363f"),d=a("2ef0"),f=a("59c7"),h={mixins:[u["a"]],components:{Table:f["Table"],CommonContent:s["a"],HomePageInfo:p["a"],PageWrapper:l["a"],PageContentWrapper:c["a"]},props:["id","initMode","version","policyType"],data:function(){var e=this.isTestPolicy;return{activePage:"policy_info",mode:void 0,form:{policyId:null,policyName:null,macStart:e?"":"000000000000",macEnd:"ffffffffffff",homePageVerEnd:"9999999",homePageVerStart:"",priority:null,policyStatus:3,deviceInfos:[],normalHpList:[],childHpList:[],regionCityPairs:[],specialNormalHp:[],specialChildHp:[]},formRules:{},ageOptions:[],ageEnums:{}}},computed:{resourceInfo:function(){var e=this.form,t="childPolicy";if(e.policyId)return{id:e.policyId,type:"policy",menuElId:t,version:e.currentVersion,status:e.policyStatus}},resourceName:function(){var e={normal:"策略",test:"测试策略",child:"儿童策略"};return e[this.policyType]},homepageTableHeader:function(){var e=this,t=[{label:"年龄",prop:"age",width:"100px",render:function(e,t){var a=t.row,i=a.age;return 0===i?"不限":i+"岁"}},{label:"首页方案ID",prop:"homepageId",width:"150px"},{label:"首页方案名称",prop:"homepageName",render:function(t,a){var i=a.row;if(i.homepageId)return t("el-button",{props:{type:"text"},on:{click:function(){e.handlePreviewHomepage(i)}}},i.homepageName)}}];return"read"!==this.mode&&t.push({label:"操作",width:"200px",render:function(t,a){a.row;var i=a.$index;return t(m["a"],{props:{title:"选择方案",selectionType:"single",homepageModel:"child"},on:{"select-end":function(t){e.handleSelectHomepageEnd(i,t)}}})}}),t}},methods:{getHomepageInfo:function(e,t){return Object(n["a"])({homepageId:e.homepageId,homepageModel:e.homepageModel,homepageName:e.homepageName,homepageVersion:e.homepageVersion},t)},handlePreviewHomepage:function(e){this.homePageId=e.homepageId,this.homePageVersion=e.currentVersion,this.activePage="showHomePageDetail"},handleSelectHomepageEnd:function(e,t){var a=Object(o["a"])(t,1),i=a[0],r=this.form.childHpList,n=r[e];r.splice(e,1,this.getHomepageInfo(i,{age:n.age}))},getFormData:function(){var e=Object(d["cloneDeep"])(this.form);return e},validateFormData:function(e,t){var a=this;this.$refs.form.$refs.form.validate(function(i){if(i){var r=e.childHpList,o=r.find(function(e){return!e.homepageId});if(o)return a.$message.error("每一个年龄都需要设置首页方案");t()}else a.$message({type:"error",message:"请把表单填写完整"})})},parseDataToApi:function(e){return e.childHpList=e.childHpList.map(function(e){return{homepageId:e.homepageId,age:e.age}}),e.normalHpList=e.normalHpList.map(function(e){return{homepageId:e.homepageId}}),"replicate"===this.mode&&(e.currentVersion=""),e},submitBtn:function(e){var t=this,a=this.getFormData();a.policyStatus=e,this.validateFormData(a,function(){var e={jsonStr:JSON.stringify(t.parseDataToApi(a))};t.$service.childPolicyConfSave(e,"保存成功").then(function(e){t.$emit("upsert-end")})})},setData:function(e){e=Object(d["cloneDeep"])(e);var t=e.childHpList.reduce(function(e,t){return e[t.age+""]=t,e},{}),a=this.ageOptions.map(function(e){return Object(n["a"])({age:e.value},t[e.value+""])});this.form={currentVersion:e.currentVersion,policyId:e.policyId,policyName:e.policyName,macStart:e.macStart,macEnd:e.macEnd,homePageVerEnd:e.homePageVerEnd,homePageVerStart:e.homepageVerStart,priority:e.priority,policyStatus:e.policyStatus,deviceInfos:[],normalHpList:e.normalHpList,childHpList:a,platform:e.platform,regionCityPairs:[],specialNormalHp:[],specialChildHp:[]}},fetchData:function(e){var t={id:this.id,version:e};this.$service.getChildPolicyConfDetail(t).then(this.setData)}},created:function(){var e=this;this.mode=this.initMode||"create",this.$service.getDictType({type:"childAge"}).then(function(t){e.ageOptions=t.map(function(e){return{label:e.dictCnName,value:+e.dictEnName,disabled:e.disabled}}),e.ageEnums=t.reduce(function(e,t){return e[t.dictEnName]=t.dictCnName,e},{}),e.id&&e.fetchData(e.version)})}},g=h,v=(a("f0a4"),a("2877")),b=Object(v["a"])(g,i,r,!1,null,"dcdcd190",null);t["a"]=b.exports},"4b62":function(e,t,a){},"67ae":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("TabPage",[a("PageWrapper",[a("PageContentWrapper",{directives:[{name:"show",rawName:"v-show",value:"matching"==e.activePage,expression:"activePage == 'matching'"}]},[a("ContentCard",{attrs:{title:"主页匹配"}},[a("div",{attrs:{slot:"actions"},slot:"actions"}),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form",{directives:[{name:"form-autocomplete",rawName:"v-form-autocomplete"}],ref:"form",attrs:{model:e.filter,rules:e.rules,"label-width":"80px"},nativeOn:{reset:function(t){return t.preventDefault(),e.handleFilterReset(t)},submit:function(t){return e.handleFilter(t)}}},[a("el-form-item",{attrs:{label:"模式"}},[a("el-radio-group",{model:{value:e.filter.pattern,callback:function(t){e.$set(e.filter,"pattern",t)},expression:"filter.pattern"}},e._l(e.patternOptions,function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v("\n                  "+e._s(t.label)+"\n                ")])}),1)],1),a("el-form-item",{attrs:{label:"fMode"}},[a("el-radio-group",{model:{value:e.filter.fMode,callback:function(t){e.$set(e.filter,"fMode",t)},expression:"filter.fMode"}},e._l(e.fModeOptions,function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v("\n                  "+e._s(t.label)+"\n                ")])}),1)],1),a("el-form-item",{attrs:{label:"机型",prop:"model"}},[a("el-input",{attrs:{autocomplete:"on",name:"model",placeholder:"机型",clearable:""},model:{value:e.filter.model,callback:function(t){e.$set(e.filter,"model","string"===typeof t?t.trim():t)},expression:"filter.model"}})],1),a("el-form-item",{attrs:{label:"机芯",prop:"chip"}},[a("el-input",{attrs:{autocomplete:"on",name:"chip",placeholder:"机芯",clearable:""},model:{value:e.filter.chip,callback:function(t){e.$set(e.filter,"chip","string"===typeof t?t.trim():t)},expression:"filter.chip"}})],1),a("el-form-item",{attrs:{label:"Mac",prop:"mac"}},[a("el-input",{attrs:{autocomplete:"on",name:"mac",placeholder:"mac地址, 12 位[0-9a-fA-F]字符",clearable:""},model:{value:e.filter.mac,callback:function(t){e.$set(e.filter,"mac",t)},expression:"filter.mac"}})],1),a("el-form-item",{attrs:{label:"屏幕尺寸",prop:"screenSize"}},[a("el-input",{attrs:{autocomplete:"on",name:"screenSize",placeholder:"屏幕尺寸, 正整数，例如 60",clearable:""},model:{value:e.filter.screenSize,callback:function(t){e.$set(e.filter,"screenSize",e._n(t))},expression:"filter.screenSize"}})],1),a("el-form-item",{attrs:{label:"主页版本",prop:"homepageVersion"}},[a("el-input",{attrs:{autocomplete:"on",name:"homepageVersion",placeholder:"主页版本",clearable:""},model:{value:e.filter.homepageVersion,callback:function(t){e.$set(e.filter,"homepageVersion",t)},expression:"filter.homepageVersion"}})],1),a("el-form-item",{attrs:{label:"整机版本",prop:"tcVersion"}},[a("el-input",{attrs:{autocomplete:"on",name:"tcVersion",placeholder:"整机版本",clearable:""},model:{value:e.filter.tcVersion,callback:function(t){e.$set(e.filter,"tcVersion",t)},expression:"filter.tcVersion"}})],1),a("el-form-item",{attrs:{label:"设备ID",prop:"devId"}},[a("el-input",{attrs:{autocomplete:"on",name:"devId",placeholder:"设备ID",clearable:""},model:{value:e.filter.devId,callback:function(t){e.$set(e.filter,"devId",t)},expression:"filter.devId"}})],1),a("el-form-item",[a("el-button",{attrs:{"native-type":"submit",type:"primary"}},[e._v("查询")]),a("el-button",{attrs:{"native-type":"reset"}},[e._v("重置")])],1)],1)],1),a("el-col",{attrs:{span:16}},[a("pre",{staticClass:"result-viwer"},[e._v(e._s(e.matchResultStr))]),a("div",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.matchResult.policy_id,expression:"matchResult.policy_id"}],attrs:{type:"primary"},on:{click:function(t){return e.handlePreviewPolicy(e.matchResult.policy_id)}}},[e._v("预览策略（"+e._s(e.matchResult.policy_id)+"）")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.matchResult.homepage_id,expression:"matchResult.homepage_id"}],attrs:{type:"primary"},on:{click:function(t){return e.handlePreviewHomepage(e.matchResult.homepage_id)}}},[e._v("预览首页方案（"+e._s(e.matchResult.homepage_id)+"）")])],1)])],1)],1)],1),"policy"==e.activePage?a("PageContentWrapper",["child"===e.policyPattern?a("ChildPolicy",{attrs:{id:e.policyId,"init-mode":"read"},on:{"upsert-end":function(t){e.activePage="matching"},"go-back":function(t){e.activePage="matching"}}}):a("Policy",{attrs:{id:e.policyId,"init-mode":"read"},on:{"upsert-end":function(t){e.activePage="matching"},"go-back":function(t){e.activePage="matching"}}})],1):e._e(),"homepage"==e.activePage?a("PageContentWrapper",[a("HomePageInfo",{attrs:{id:e.homepageId,"init-mode":"read"},on:{"upsert-end":function(t){e.activePage="matching"},"go-back":function(t){e.activePage="matching"}}})],1):e._e()],1)],1)},r=[],o=a("bbf7"),n=a("4bc7"),l=a("5f87"),c=a("ce71"),s=a("99cd"),p=a("3983"),m={components:{TabPage:o["a"],Policy:s["a"],ChildPolicy:p["a"],HomePageInfo:c["a"],PageWrapper:n["a"],PageContentWrapper:l["a"]},data:function(){return{activePage:"matching",homepageId:void 0,policyId:void 0,policyPattern:void 0,matchResult:"",fModeOptions:[{label:"无",value:"Default"},{label:"卖场模式",value:"Other"}],patternOptions:[{label:"标准模式",value:"normal"},{label:"儿童模式",value:"child"}],filter:this.genDefaultFilter(),rules:{model:[{required:!0,message:"请输入机型"}],chip:[{required:!0,message:"请输入机芯"}],screenSize:[{validator:function(e,t,a){var i=/^[1-9]\d*$/;if(""!==t&&!i.test(t))return a(new Error("屏幕尺寸应该为一个正整数"));a()}}],mac:[{validator:function(e,t,a){var i=/^[0-9a-fA-F]{12}$/;if(t&&!i.test(t))return a(new Error("请输入 12 位[0-9a-fA-F]字符"));a()}}],homepageVersion:[{validator:function(e,t,a){var i=/^[0-9]{7}$/;if(t&&!i.test(t))return a(new Error("格式不正确，应该 7 位数字"));a()}}],tcVersion:[{validator:function(e,t,a){var i=/^[0-9]{1,9}$/;if(t&&!i.test(t))return a(new Error("格式应为不超过 9 位的数字"));a()}}]}}},computed:{matchResultStr:function(){var e=this.matchResult;if(e)return JSON.stringify(e,void 0,2)}},methods:{genDefaultFilter:function(){return{pattern:"normal",fMode:"Default",chip:"",model:"",mac:"",screenSize:"",homepageVersion:"",tcVersion:"",devId:""}},handleFilter:function(e){var t=this;this.matchResult="",this.$refs.form.validate(function(e){if(e){var a=t.filter,i=a.pattern;t.$service.homepageMatchingList(a).then(function(e){t.policyPattern=i,t.matchResult=e})}else t.$message.error("请把表单填写完整")})},handleFilterReset:function(){var e=this;this.filter=this.genDefaultFilter(),this.$nextTick(function(){e.$refs.form.clearValidate()}),this.matchResult=""},handlePreviewHomepage:function(e){this.activePage="homepage",this.homepageId=e},handlePreviewPolicy:function(e){this.activePage="policy",this.policyId=e}}},u=m,d=(a("d2b2"),a("2877")),f=Object(d["a"])(u,i,r,!1,null,"6af505cc",null);t["default"]=f.exports},d2b2:function(e,t,a){"use strict";var i=a("ead5"),r=a.n(i);r.a},ead5:function(e,t,a){},f0a4:function(e,t,a){"use strict";var i=a("4b62"),r=a.n(i);r.a}}]);
//# sourceMappingURL=chunk-c9c8ab1e.9e3eac39.js.map