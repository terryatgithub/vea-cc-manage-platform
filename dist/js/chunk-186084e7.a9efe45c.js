(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-186084e7"],{"05b4":function(e,t,i){"use strict";var n=i("5224"),a=i.n(n);a.a},3983:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("PageWrapper",{staticClass:"policy-info-wrapper"},[i("PageContentWrapper",{directives:[{name:"show",rawName:"v-show",value:"policy_info"===e.activePage,expression:"activePage === 'policy_info'"}]},[i("ContentCard",{attrs:{title:e.title},on:{"go-back":function(t){return e.$emit("go-back")}}},[i("CommonContent",{attrs:{mode:e.mode,"resource-info":e.resourceInfo},on:{replicate:function(t){e.mode="replicate"},edit:function(t){e.mode="edit"},unaudit:function(t){return e.$emit("upsert-end")},shelves:e.fetchData,"submit-audit":function(t){return e.submitBtn(3)},"save-draft":function(t){return e.submitBtn(2)},audit:function(t){return e.$emit("upsert-end")},"select-version":e.fetchData,delete:function(t){return e.$emit("upsert-end",t)}}},[i("div",{staticClass:"form-legend-header"},[i("i",{staticClass:"el-icon-edit"},[e._v("基本信息")])]),i("DataForm",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"策略名称"}},[e._v("\n            "+e._s(e.form.policyName)+"\n          ")]),i("el-form-item",{attrs:{label:"首页方案"}},[i("Table",{attrs:{"selection-type":"none",header:e.homepageTableHeader,data:e.form.childHpList}})],1)],1)],1)],1)],1),"showHomePageDetail"===e.activePage?i("PageContentWrapper",[i("HomePageInfo",{attrs:{id:e.homePageId,"init-mode":"read",version:e.homePageVersion,"title-prefix":e.title},on:{"upsert-end":function(t){e.activePage="policy_info"},"go-back":function(t){e.activePage="policy_info"}}})],1):e._e()],1)},a=[],o=(i("7514"),i("768b")),r=i("cebc"),l=i("4bc7"),c=i("5f87"),s=i("c3d5"),d=i("ce71"),p=i("07d0"),h=i("363f"),u=i("2ef0"),f=i("59c7"),m={mixins:[h["a"]],components:{Table:f["Table"],CommonContent:s["a"],HomePageInfo:d["a"],PageWrapper:l["a"],PageContentWrapper:c["a"]},props:["id","initMode","version","policyType"],data:function(){var e=this.isTestPolicy;return{activePage:"policy_info",mode:void 0,form:{policyId:null,policyName:null,macStart:e?"":"000000000000",macEnd:"ffffffffffff",homePageVerEnd:"9999999",homePageVerStart:"",priority:null,policyStatus:3,deviceInfos:[],normalHpList:[],childHpList:[],regionCityPairs:[],specialNormalHp:[],specialChildHp:[]},formRules:{},ageOptions:[],ageEnums:{}}},computed:{resourceInfo:function(){var e=this.form,t="childPolicy";if(e.policyId)return{id:e.policyId,type:"policy",menuElId:t,version:e.currentVersion,status:e.policyStatus}},resourceName:function(){var e={normal:"策略",test:"测试策略",child:"儿童策略"};return e[this.policyType]},homepageTableHeader:function(){var e=this,t=[{label:"年龄",prop:"age",width:"100px",render:function(e,t){var i=t.row,n=i.age;return 0===n?"不限":n+"岁"}},{label:"首页方案ID",prop:"homepageId",width:"150px"},{label:"首页方案名称",prop:"homepageName",render:function(t,i){var n=i.row;if(n.homepageId)return t("el-button",{props:{type:"text"},on:{click:function(){e.handlePreviewHomepage(n)}}},n.homepageName)}}];return"read"!==this.mode&&t.push({label:"操作",width:"200px",render:function(t,i){i.row;var n=i.$index;return t(p["a"],{props:{title:"选择方案",selectionType:"single",homepageModel:"child"},on:{"select-end":function(t){e.handleSelectHomepageEnd(n,t)}}})}}),t}},methods:{getHomepageInfo:function(e,t){return Object(r["a"])({homepageId:e.homepageId,homepageModel:e.homepageModel,homepageName:e.homepageName,homepageVersion:e.homepageVersion},t)},handlePreviewHomepage:function(e){this.homePageId=e.homepageId,this.homePageVersion=e.currentVersion,this.activePage="showHomePageDetail"},handleSelectHomepageEnd:function(e,t){var i=Object(o["a"])(t,1),n=i[0],a=this.form.childHpList,r=a[e];a.splice(e,1,this.getHomepageInfo(n,{age:r.age}))},getFormData:function(){var e=Object(u["cloneDeep"])(this.form);return e},validateFormData:function(e,t){var i=this;this.$refs.form.$refs.form.validate(function(n){if(n){var a=e.childHpList,o=a.find(function(e){return!e.homepageId});if(o)return i.$message.error("每一个年龄都需要设置首页方案");t()}else i.$message({type:"error",message:"请把表单填写完整"})})},parseDataToApi:function(e){return e.childHpList=e.childHpList.map(function(e){return{homepageId:e.homepageId,age:e.age}}),e.normalHpList=e.normalHpList.map(function(e){return{homepageId:e.homepageId}}),"replicate"===this.mode&&(e.currentVersion=""),e},submitBtn:function(e){var t=this,i=this.getFormData();i.policyStatus=e,this.validateFormData(i,function(){var e={jsonStr:JSON.stringify(t.parseDataToApi(i))};t.$service.childPolicyConfSave(e,"保存成功").then(function(e){t.$emit("upsert-end")})})},setData:function(e){e=Object(u["cloneDeep"])(e);var t=e.childHpList.reduce(function(e,t){return e[t.age+""]=t,e},{}),i=this.ageOptions.map(function(e){return Object(r["a"])({age:e.value},t[e.value+""])});this.form={currentVersion:e.currentVersion,policyId:e.policyId,policyName:e.policyName,macStart:e.macStart,macEnd:e.macEnd,homePageVerEnd:e.homePageVerEnd,homePageVerStart:e.homepageVerStart,priority:e.priority,policyStatus:e.policyStatus,deviceInfos:[],normalHpList:e.normalHpList,childHpList:i,platform:e.platform,regionCityPairs:[],specialNormalHp:[],specialChildHp:[]}},fetchData:function(e){var t={id:this.id,version:e};this.$service.getChildPolicyConfDetail(t).then(this.setData)}},created:function(){var e=this;this.mode=this.initMode||"create",this.$service.getDictType({type:"childAge"}).then(function(t){e.ageOptions=t.map(function(e){return{label:e.dictCnName,value:+e.dictEnName,disabled:e.disabled}}),e.ageEnums=t.reduce(function(e,t){return e[t.dictEnName]=t.dictCnName,e},{}),e.id&&e.fetchData(e.version)})}},g=m,v=(i("f0a4"),i("2877")),y=Object(v["a"])(g,n,a,!1,null,"dcdcd190",null);t["a"]=y.exports},"4b62":function(e,t,i){},5224:function(e,t,i){},"6f00":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("TabPage",[i("PolicyManageList",{directives:[{name:"show",rawName:"v-show",value:e.isShowList,expression:"isShowList"}],ref:"list",on:{create:e.handleCreate,read:e.handleRead,edit:e.handleEdit,delete:e.handleDelete}}),e.isShowList?e._e():i("PolicyManageInfo",{attrs:{id:e.id,"init-mode":e.mode,version:e.version,"policy-type":"child"},on:{"upsert-end":e.handleUpsertEnd,"go-back":e.goBack}})],1)},a=[],o=i("bbf7"),r=i("3983"),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContentCard",{ref:"contentCard",staticClass:"content"},[i("ContentWrapper",{attrs:{filter:e.filter,filterSchema:e.filterSchema,pagination:e.pagination},on:{"filter-change":e.handleFilterChange,"filter-reset":e.handleFilterReset}},[i("ButtonGroupForListPage",{attrs:{pageName:"childPolicy"},on:{add:e.handleCreate,edit:e.handleEdit,delete:e.handleDelete}}),i("Table",{staticClass:"policy-list",attrs:{props:e.table.props,header:e.table.header,data:e.table.data,selected:e.table.selected,"selection-type":e.table.selectionType,"select-on-row-click":!0},on:{"row-selection-add":e.handleRowSelectionAdd,"row-selection-remove":e.handleRowSelectionRemove,"all-row-selection-change":e.handleAllRowSelectionChange}})],1)],1)},c=[],s=(i("ac6a"),i("75fc")),d=i("f6e7"),p=i.n(d),h=i("59c7"),u=i("2df9"),f=i("3912"),m={extends:f["a"],components:{Table:h["Table"],ContentWrapper:h["ContentWrapper"],ButtonGroupForListPage:u["a"]},data:function(){var e=this;return{resourceType:"policy",filter:{},filterSchema:null,pagination:{pageSize:10},selected:[],selectedItems:[],table:{props:{rowKey:"policyId",treeProps:{children:"children"}},header:[{label:"ID",prop:"policyId",width:70},{label:"策略名称",prop:"policyName",minWidth:150,"show-overflow-tooltip":!0,render:function(t,i){var n=i.row,a=t("i",{class:n.children?"el-icon-folder":"el-icon-document"}),o=t("el-button",{attrs:{type:"text"},on:{click:function(){e.handleRead(n)}}},n.policyName);return t("div",null,[a,o])}},{label:"关联首页方案",width:150,prop:"relationHomepageName"},{label:"版本",prop:"currentVersion"},{label:"状态",prop:"policyStatus",render:function(t,i){var n=i.row;return e.$numToAuditStatus(n.policyStatus)}},{label:"待审核副本",prop:"duplicateVersion",align:"center",render:function(t,i){var n=i.row;return""===n.duplicateVersion?"":t("el-button",{attrs:{type:"text"},on:{click:function(){e.handleRead(n,n.duplicateVersion)}}},n.duplicateVersion)}},{label:"更新时间",prop:"lastUpdateDate",width:140},{label:"更新人",prop:"modifierName"},{label:"操作",render:function(t,i){var n=i.row;if(n.showContentAuthSettingBtn)return t("el-button",{props:{type:"text"},on:{click:function(t){t.stopPropagation(),e.handleOpenContentAuthManager(n)}}},"内容权限")}}],data:[],selected:[],selectionType:"multiple"}}},methods:{handleOpenContentAuthManager:function(e){this.$refs.contentCard.handleShowContentAuthManager({id:e.policyId,type:"policy",menuElId:"policyConf"})},handleFilterChange:function(e,t){t&&(this.filter=t),"query"===e&&(this.pagination.currentPage=1),this.fetchData()},handleFilterReset:function(){this.filter={},this.pagination.currentPage=1,this.fetchData()},parseFilter:function(){var e=this.filter,t=this.pagination;return t&&(e.page=t.currentPage,e.rows=t.pageSize),e},fetchData:function(){var e=this,t=this.parseFilter();this.$service.getChildPolicyManagePageList(t).then(function(t){e.pagination.total=t.total,e.table.data=t.rows||[]})},expandItem:function(e){return e.children?[e].concat(Object(s["a"])(e.children)):[e]},handleRowSelectionAdd:function(e){this.selected=this.selected.concat(this.expandItem(e)),this.updateTableSelected()},handleRowSelectionRemove:function(e){var t="policyId",i=this.expandItem(e).reduce(function(e,i){return e[i[t]]=!0,e},{});this.selected=this.selected.filter(function(e){return!i[e[t]]}),this.updateTableSelected()},handleAllRowSelectionChange:function(e){e?this.table.data.forEach(this.handleRowSelectionAdd):(this.selected=[],this.table.selected=[])},updateTableSelected:function(){var e=this,t="policyId",i=this.table,n=this.selected.reduce(function(e,i){return e[i[t]]=!0,e},{}),a=i.data.reduce(function(t,i){return t.concat(e.expandItem(i))},[]);i.selected=a.reduce(function(e,i,a){return n[i[t]]&&e.push(a),e},[])}},created:function(){var e=p.a.map({policyId:p.a.o.oneOf([p.a.value(""),p.a.number]).$msg("请输入数字").other("form",{component:"InputPositiveInt",placeholder:"ID"}),policyName:p.a.o.string.other("form",{component:"Input",placeholder:"策略名称"}),policyStatus:p.a.o.enum({"下架":"0","上架":"1","草稿":"2","待审核":"3","审核通过":"4","审核不通过":"5"}).other("form",{component:"Select",placeholder:"状态"})}).other("form",{cols:{item:5,label:0,wrapper:20},layout:"inline",footer:{cols:{label:0,wrapper:24},showSubmit:!0,submitText:"查询",showReset:!0,resetText:"重置"}});this.filterSchema=e,this.fetchData()}},g=m,v=(i("05b4"),i("2877")),y=Object(v["a"])(g,l,c,!1,null,"599b9264",null),b=y.exports,w={components:{TabPage:o["a"],PolicyManageInfo:r["a"],PolicyManageList:b},data:function(){return{isShowList:!0,id:void 0,mode:"create",version:void 0}},methods:{handleCreate:function(){this.id=void 0,this.mode="create",this.isShowList=!1},handleEdit:function(e){this.id=e.policyId,this.mode="edit",this.isShowList=!1},handleRead:function(e,t){this.id=e.policyId,this.mode="read",this.version=t,this.isShowList=!1},handleDelete:function(e){var t=this;this.$service.policyConfRemove({id:e.map(function(e){return e.policyId}).join(",")},"删除成功").then(function(){t.$refs.list.fetchData()})},handleUpsertEnd:function(e){this.$refs.list.fetchData(),e||(this.isShowList=!0,this.mode="list",this.version=void 0)},goBack:function(){this.isShowList=!0,this.mode="list",this.version=void 0}}},P=w,I=Object(v["a"])(P,n,a,!1,null,null,null);t["default"]=I.exports},f0a4:function(e,t,i){"use strict";var n=i("4b62"),a=i.n(n);a.a}}]);
//# sourceMappingURL=chunk-186084e7.a9efe45c.js.map