(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49f36ed8"],{"5c07":function(e,t,a){},"724d":function(e,t,a){"use strict";a.r(t);var n,s,i=a("519c"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentCard",{attrs:{title:e.title},on:{"go-back":function(t){return e.$emit("go-back")}}},[a("CommonContent",{attrs:{mode:e.mode}},[a("div",{staticClass:"actions",attrs:{slot:"auditAndDraft"},slot:"auditAndDraft"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("\n        保存\n      ")])],1),a("DataForm",{ref:"form",attrs:{readonly:"read"===e.mode,model:e.form,"label-width":"120px"}},[a("DataEnum",{attrs:{label:"内容源",rules:e.rules.source,prop:"source",type:"radio",value:e.form.source,options:e.$consts.sourceOptions},on:{input:e.handleChangeSource}}),a("DataString",{attrs:{label:"任务名称",rules:e.rules.taskName,prop:"taskName"},model:{value:e.form.taskName,callback:function(t){e.$set(e.form,"taskName",t)},expression:"form.taskName"}}),a("DataAny",{attrs:{label:"版面",rules:e.rules.tabId,prop:"tabId"}},[a("div",{attrs:{slot:"edit"},slot:"edit"},[a("TabSelector",{attrs:{source:e.form.source,"selection-type":"single"},on:{"select-end":e.handleSelectTabEnd}}),e.form.tabId?a("span",[e._v("\n            已选择: "+e._s(e.form.tabId)+"\n          ")]):e._e()],1),a("div",{attrs:{slot:"read"},slot:"read"},[e._v("\n          "+e._s(e.form.tabId)+"\n        ")])]),a("DataAny",{attrs:{label:"强插位置",rules:e.rules.insertIndex,prop:"insertIndex"}},[a("InputPositiveInt",{attrs:{slot:"edit"},slot:"edit",model:{value:e.form.insertIndex,callback:function(t){e.$set(e.form,"insertIndex",t)},expression:"form.insertIndex"}}),a("span",{attrs:{slot:"read"},slot:"read"},[e._v(" "+e._s(e.form.insertIndex))])],1),a("DataAny",{attrs:{label:"定向人群",rules:e.rules.dmpRegistryInfo,prop:"dmpRegistryInfo.dmpCrowdId"},model:{value:e.form.dmpRegistryInfo,callback:function(t){e.$set(e.form,"dmpRegistryInfo",t)},expression:"form.dmpRegistryInfo"}},[a("div",{attrs:{slot:"edit"},slot:"edit"},[a("DmpSelector",{on:{"select-end":e.handleSelectCrowdEnd}}),e.form.dmpRegistryInfo.dmpCrowdId?a("span",[e._v("\n            已选择: "+e._s(e.form.dmpRegistryInfo.dmpPolicyName)+"("+e._s(e.form.dmpRegistryInfo.dmpPolicyId)+")/"+e._s(e.form.dmpRegistryInfo.dmpCrowdName)+"("+e._s(e.form.dmpRegistryInfo.dmpCrowdId)+")\n          ")]):e._e()],1),a("div",{attrs:{slot:"read"},slot:"read"},[e._v("\n          "+e._s(e.form.dmpRegistryInfo.dmpPolicyName)+"("+e._s(e.form.dmpRegistryInfo.dmpPolicyId)+")/"+e._s(e.form.dmpRegistryInfo.dmpCrowdName)+"("+e._s(e.form.dmpRegistryInfo.dmpCrowdId)+")\n        ")])])],1)],1)],1)},l=[],r=a("8353"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"remote-selector-wrapper"},[a("div",{on:{click:e.handleSelectStart}},[e._t("default",[a("el-button",{attrs:{type:"primary",disabled:e.disabled,plain:""}},[e._v(" "+e._s(e.title||"选择人群"))])])],2),a("div",{staticClass:"crowd-selector"},[a("el-dialog",{attrs:{title:"选择策略",visible:e.showPolicySelector,"append-to-body":"","before-close":e.handleClose}},[a("div",{staticClass:"name-list"},e._l(e.policy.items,function(t){return a("div",{key:t.value,staticClass:"name-list__item",attrs:{title:t.label},on:{click:function(a){return e.handleSelectPolicy(t)}}},[e._v(e._s(t.label))])}),0)]),a("el-dialog",{attrs:{title:"选择人群","append-to-body":"",visible:e.showCrowdSelector,"before-close":e.handleSelectCrowdCancel}},[e.hasCascadeTag?a("div",[a("el-cascader",{attrs:{options:e.crowd.cascadeItems,filterable:"",expandTrigger:"hover",disabled:0===e.crowd.cascadeItems.length,placeholder:e.crowd.cascadeItems.length>0?"请选择":"无人群数据","change-on-select":""},model:{value:e.selectedCascaderCrowd,callback:function(t){e.selectedCascaderCrowd=t},expression:"selectedCascaderCrowd"}}),a("el-button",{attrs:{disabled:!e.selectedCascaderCrowd,type:"primary"},on:{click:e.handleSelectCascadeCrowd}},[e._v("确定")])],1):a("div",{staticClass:"name-list"},e._l(e.crowd.items,function(t){return a("div",{key:t.value,staticClass:"name-list__item",attrs:{title:t.label},on:{click:function(a){return e.handleSelectCrowd(t)}}},[e._v(e._s(t.label))])}),0)])],1)])},d=[],u=(a("7514"),{data:function(){return{hasCascadeTag:!1,showPolicySelector:!1,showCrowdSelector:!1,selectedPolicy:void 0,selectedCrowd:void 0,selectedCascaderCrowd:void 0,policy:{pagination:{},items:[]},crowd:{pagination:{},items:[],cascadeItems:[]}}},props:["selectedPolicyId","selectedCrowdId","title","disabled","isLive"],methods:{handleSelectStart:function(){var e=this;this.$emit("select-start"),this.showPolicySelector=!0,this.$service.getCrowdPolicy().then(function(t){e.policy.items=t})},handleClose:function(){this.showCrowdSelector=!1,this.showPolicySelector=!1,setTimeout(function(){this.$emit("select-cancel")}.bind(this),20)},handleSelectPolicy:function(e){this.selectedPolicy=e,this.$service.crowdRelGet({id:e.value}).then(function(t){t.hasCascadeTag?(this.hasCascadeTag=!0,this.crowd.items=t.crowdRelationship.items||[],this.crowd.cascadeItems=this.listToTree(t.crowdRelationship.items),this.showCrowdSelector=!0):this.$service.getCrowdOfPolicyWithCache({id:e.value}).then(function(e){this.hasCascadeTag=!1,this.crowd.items=e,this.showCrowdSelector=!0}.bind(this))}.bind(this))},handleSelectCrowd:function(e){this.selectedCrowd=e,this.selectEnd()},handleSelectCascadeCrowd:function(){var e=this.selectedCascaderCrowd.slice(-1)[0];this.selectedCrowd=this.crowd.items.find(function(t){return t.value===e}),this.selectEnd()},handleSelectCrowdCancel:function(){this.showCrowdSelector=!1},selectEnd:function(){this.$emit("select-end",this.selectedPolicy,this.selectedCrowd),this.showCrowdSelector=!1,this.showPolicySelector=!1},listToTree:function(e,t){e=JSON.parse(JSON.stringify(e)),t=t||{};for(var a,n,s,i=t.idKey||"value",o=t.parentKey||"parentValue",l=t.childrenKey||"children",r=[],c={},d=0,u=e.length;d<u;d++)a=e[d],n=a[i],s=a[o]||0,c[n]=c[n]||[],a[l]=c[n],0!=s?(c[s]=c[s]||[],c[s].push(a)):r.push(a);return r}}}),f=u,p=(a("e1e0"),a("2877")),h=Object(p["a"])(f,c,d,!1,null,"2b881a5c",null),m=h.exports,b=a("c3d5"),v=a("2149"),g=a("2ef0"),k={extends:i["a"].ResourceBaseContent,components:{TabSelector:r["a"],DmpSelector:m,CommonContent:b["a"],InputPositiveInt:v["a"]},data:function(){return{resourceName:"版面强插任务",form:{source:this.$consts.sourceOptions[0].value,taskName:void 0,tabId:void 0,insertIndex:void 0,dmpRegistryInfo:{}},rules:{source:[{required:!0,message:"请输入内容源",trigger:"blur"}],taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"},{max:45,message:"长度不能超过 45 个字符",trigger:"blur"}],tabId:[{required:!0,message:"请输入版面",trigger:"blur"}],insertIndex:[{required:!0,message:"请输入强插位置",trigger:"blur"}],dmpRegistryInfo:[{required:!0,message:"请选择人群",trigger:"blur"}]}}},methods:{handleChangeSource:function(e){var t=this.form;t.source=e,t.tabId=void 0},handleSelectTabEnd:function(e){this.form.tabId=e.tabId},handleSelectCrowdEnd:function(e,t){this.form.dmpRegistryInfo={dmpPolicyId:e.value,dmpCrowdId:t.value,dmpPolicyName:e.label,dmpCrowdName:t.label}},validate:function(e,t){var a=this;this.$refs.form.$refs.form.validate(function(e){e?t():a.$message.error("请把表单填写完整")})},parseDataToApi:function(e){},handleSave:function(){var e=this,t=this.$utils.cloneDeep(this.form);this.validate(t,function(){e.$confirm("保存后不可修改，确定要保存?","提示").then(function(){e.$service.tabInsertionTaskUpsert(t,"保存成功").then(function(){e.$emit("upsert-end")})}).catch(function(){})})},setTabInsertionTask:function(e){this.form=Object(g["cloneDeep"])(e)},fetchData:function(){var e=this;this.$service.tabInsertionTaskGetDetail({id:this.id}).then(function(t){e.setTabInsertionTask(t)})}},created:function(){this.mode=this.initMode,this.id&&this.fetchData(this.version)}},w=k,y=(a("d181"),Object(p["a"])(w,o,l,!1,null,"363e735e",null)),I=y.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentCard",[a("ListLayout",{attrs:{pagination:e.pagination},on:{"pagingation-change":e.fetchData}},[a("el-form",{attrs:{slot:"filter",inline:!0},slot:"filter"},[a("el-form-item",[a("el-select",{attrs:{clearable:"",placeholder:"开启状态"},model:{value:e.filter.enableTask,callback:function(t){e.$set(e.filter,"enableTask",t)},expression:"filter.enableTask"}},e._l(e.taskStatusOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",[a("el-select",{attrs:{clearable:"",placeholder:"内容源"},model:{value:e.filter.source,callback:function(t){e.$set(e.filter,"source",t)},expression:"filter.source"}},e._l(e.$consts.sourceOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-button",{attrs:{type:"primary"},on:{click:e.handleFilter}},[e._v("查询")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleResetFilter}},[e._v("重置")])],1),a("ActionList",{attrs:{slot:"actions",actions:[{label:"新建",value:"create",type:"primary"}]},on:{create:e.handleCreate,edit:e.handleEdit,delete:e.handleDelete},slot:"actions"}),a("Table",{attrs:{slot:"table",props:e.table.props,header:e.table.header,data:e.table.data,selected:e.table.selected,"selection-type":e.table.selectionType,"select-on-row-click":!0},on:{"row-selection-add":e.handleRowSelectionAdd,"row-selection-remove":e.handleRowSelectionRemove,"all-row-selection-change":e.handleAllRowSelectionChange},slot:"table"})],1),a("el-dialog",{attrs:{visible:e.showEnableTaskDialog,"append-to-body":!0,width:"400px"},on:{"update:visible":function(t){e.showEnableTaskDialog=t}}},[a("el-form",{ref:"taskStatusForm",attrs:{model:e.taskInfo,rules:e.taskInfoRules}},[a("el-form-item",{attrs:{prop:"aliveTime"}},[e._v("\n        任务持续时间\n        "),a("div",{staticClass:"display-inline-block"},[a("InputPositiveInt",{model:{value:e.taskInfo.aliveTime,callback:function(t){e.$set(e.taskInfo,"aliveTime",e._n(t))},expression:"taskInfo.aliveTime"}})],1),e._v("\n        小时\n        "),a("p",[e._v("开启 24 小时即可覆盖 65% 用户, 建议不要超过 168 小时")])]),a("el-button",{staticClass:"h-center",attrs:{type:"primary"},on:{click:e.handleUpsertTaskStatus}},[e._v("确定")])],1)],1)],1)},T=[],_=a("59c7"),S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._t("top"),a("div",{staticClass:"list-layout-filter-form"},[e._t("filter")],2),e.$slots.actions?a("div",{staticClass:"list-layout-actions"},[e._t("actions")],2):e._e(),a("div",{staticClass:"list-layout-table"},[e._t("table")],2),a("div",{staticClass:"list-layout-pagination"},[e._t("pagination",[e.pagination?a("el-pagination",{attrs:{"current-page":e.pagination.currentPage,"page-sizes":[15,20,30,50,100,200],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handlePageSizeChange,"current-change":e.handlePageChange}}):e._e()])],2),e._t("bottom")],2)},$=[],P={props:["pagination"],methods:{handlePageSizeChange:function(e){this.pagination.pageSize=e,this.$emit("pagingation-change")},handlePageChange:function(e){this.pagination.currentPage=e,this.$emit("pagingation-change")}}},D=P,R=(a("b803"),Object(p["a"])(D,S,$,!1,null,"3379e9d6",null)),x=R.exports,E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.actions||e.defaultAction,function(t,n){return a("el-button",{key:n,attrs:{type:t.type},on:{click:function(a){return e.$emit(t.value,a)}}},[e._v("\n    "+e._s(t.label)+"\n  ")])}),1)},F=[],N={data:function(){return{defaultAction:[{label:"新建",value:"create",type:"primary"},{label:"编辑",value:"edit",type:"primary"},{label:"删除",value:"delete",type:"danger"}]}},props:["actions"]},O=N,A=Object(p["a"])(O,E,F,!1,null,null,null),j=A.exports,L={extends:i["a"].ResourceBaseList,components:{Table:_["Table"],ActionList:j,ListLayout:x,InputPositiveInt:v["a"]},data:function(){var e=this;this.$createElement;return{taskStatusOptions:[{label:"开启",value:1},{label:"关闭",value:0}],filter:this.genDefaultFilter(),effictientFilter:this.genDefaultFilter(),selected:[],table:{props:{},selected:[],selectionType:"multiple",header:[{prop:"taskId",label:"任务ID"},{prop:"taskName",label:"任务名称",render:function(t,a){var n=a.row;return t("el-button",{attrs:{type:"text"},on:{click:function(){return e.handleRead(n)}}},[n.taskName])}},{prop:"source",label:"内容源",render:function(t,a){var n=a.row;return e.$consts.sourceText[n.source]}},{prop:"tabName",label:"版面"},{prop:"insertIndex",label:"强插位置"},{prop:"aliveTime",label:"任务持续时间",render:function(e,t){var a=t.row;if(a.enableTask)return a.aliveTime+"小时"}},{prop:"endTime",label:"距离结束时间",render:function(e,t){var a=t.row;if(a.enableTask)return a.endTime+"小时"}},{label:"是否开启",prop:"enableTask",render:function(t,a){var n=a.row;return t("el-switch",{props:{value:!!n.enableTask},nativeOn:{click:function(e){e.stopPropagation()}},on:{input:function(t){e.handleToggleTask(n,t)}}})}}],data:[]},pagination:{currentPage:1,total:0},showEnableTaskDialog:!1,taskInfo:{},taskInfoRules:{aliveTime:[{required:!0,message:"请填入任务持续时间"}]}}},methods:{genTaskInfo:function(e){var t=e.taskId,a=e.enableTask,n=e.aliveTime;return{taskId:t,aliveTime:n,enableTask:a}},genDefaultFilter:function(){return{enableTask:void 0,source:void 0}},handleFilter:function(){this.pagination.currentPage=1,this.effictientFilter=Object(g["cloneDeep"])(this.filter),this.fetchData()},handleResetFilter:function(){this.pagination.currentPage=1,this.filter=this.genDefaultFilter(),this.effictientFilter=this.genDefaultFilter(),this.fetchData()},getFilter:function(){var e=this.pagination,t=Object(g["cloneDeep"])(this.effictientFilter);return e&&(t.page=e.currentPage,t.rows=e.pageSize),t},fetchData:function(){var e=this,t=this.getFilter();this.$service.tabInsertionTaskGetList(t).then(function(t){e.pagination.total=t.total,e.table.data=t.rows})},handleToggleTask:function(e,t){t=t?1:0,this.taskInfo=this.genTaskInfo({taskId:e.taskId,aliveTime:e.aliveTime,enableTask:t}),t?this.showEnableTaskDialog=!0:this.handleUpsertTaskStatus()},handleUpsertTaskStatus:function(){var e=this,t=this.taskInfo,a=t.enableTask,n=function(){var n=e.table.data.find(function(e){var a=e.taskId;return a===t.taskId});return n.enableTask=a,a&&(n.aliveTime=t.aliveTime,n.endTime=t.aliveTime),e.$service.tabInsertionTaskStatusUpsert(t,"操作成功").catch(function(){n.enableTask=!a})};a?this.$refs.taskStatusForm.validate(function(t){t?n().then(function(){e.showEnableTaskDialog=!1}):e.$message.error("请把表单填写完整")}):n()}},created:function(){this.fetchData()}},z=L,q=Object(p["a"])(z,C,T,!1,null,"4b9b1d54",null),U=q.exports,J={extends:i["a"].ResourceBaseIndex,components:{TabPage:i["a"].TabPage,ResourceList:U,ResourceContent:I},data:function(){return{idField:"taskId"}},computed:{listProps:function(){return{}},contentProps:function(){return{}},resourceInfo:function(){return{}}}},B=J,G=Object(p["a"])(B,n,s,!1,null,"52029fc2",null);t["default"]=G.exports},a2ce:function(e,t,a){},b803:function(e,t,a){"use strict";var n=a("dda3"),s=a.n(n);s.a},d181:function(e,t,a){"use strict";var n=a("5c07"),s=a.n(n);s.a},dda3:function(e,t,a){},e1e0:function(e,t,a){"use strict";var n=a("a2ce"),s=a.n(n);s.a}}]);
//# sourceMappingURL=chunk-49f36ed8.473984de.js.map